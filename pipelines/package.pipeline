pipeline {
     agent {
                label 'localhost'
            }

    stages {
        stage('Clone Source') {
            steps {
                deleteDir()
                checkout([
	                $class: 'GitSCM', 
	                branches: [[name: '*/main']], 
	                doGenerateSubmoduleConfigurations: false, 
	                extensions: [
	                	[
	                		$class: 'CloneOption', 
	                		depth: 1, 
			                noTags: false, 
			                reference: '', 
			                shallow: true
		                ], 
	                	[
	                		$class: 'RelativeTargetDirectory', 
	                		relativeTargetDir: 'jack-capture-cuimhne'
                		]
                	], 
	                submoduleCfg: [], 
	                userRemoteConfigs: [
	                	[
	                		credentialsId: 'pizero-build', 
	                		url: 'git@github.com:Claudenw/jack_capture_cuimhne.git'
	                	]
                	]
                ])
                
                checkout([
                	$class: 'GitSCM', 
                	branches: [[name: '*/main']], 
                	doGenerateSubmoduleConfigurations: false, 
                	extensions: [
                		[
                			$class: 'CloneOption', 
                			depth: 1, 
			                noTags: false, 
			                reference: '', 
			                shallow: true
		                ], 
                		[
                			$class: 'RelativeTargetDirectory', 
                			relativeTargetDir: 'jack-capture-cuimhne-pkg'
            			]
        			], 
                	submoduleCfg: [], 
                	userRemoteConfigs: [
                		[
                			credentialsId: 'pizero-build', 
                			url: 'git@github.com:Claudenw/jack_capture_cuimhne-pkg.git'
            			]
        			]
    			])
            }
        }
        stage( "Build jack-capture-cuimhne" ) {
            steps {
                dir ("jack-capture-cuimhne" ) {
                    sh '''
                    export PATH=$PATH:/opt/tools/arm-bcm2708/${platform}/bin ; 
                    export KERNEL=kernel ; 
                    export KERNELDIR=../linux
                    make ARCH=arm CROSS_COMPILE=${platform}- 
                    '''
                }
            }
        }
    }
}
